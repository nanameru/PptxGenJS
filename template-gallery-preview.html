<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PptxGenJS テンプレートギャラリー with プレビュー</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 3rem;
        }
        .template-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .template-category {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .category-title {
            color: #333;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
        }
        .btn-demo {
            background-color: #667eea;
            color: white;
            border: none;
            transition: background-color 0.3s;
            margin-right: 0.5rem;
        }
        .btn-demo:hover {
            background-color: #764ba2;
            color: white;
        }
        .btn-preview {
            background-color: #28a745;
            color: white;
            border: none;
            transition: background-color 0.3s;
        }
        .btn-preview:hover {
            background-color: #218838;
            color: white;
        }
        .template-image {
            height: 200px;
            object-fit: cover;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #6c757d;
        }
        .code-preview {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* プレビューモーダルのスタイル */
        .slide-preview-container {
            background-color: #2c2c2c;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slide-preview {
            background-color: white;
            width: 100%;
            max-width: 800px;
            aspect-ratio: 16/9;
            border-radius: 5px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        .slide-content {
            padding: 40px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .slide-navigation {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .modal-xl {
            max-width: 90%;
        }
        
        /* チャートプレビューのスタイル */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
        }
        
        /* テーブルプレビューのスタイル */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .preview-table th,
        .preview-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .preview-table th {
            background-color: #363636;
            color: white;
            font-weight: bold;
        }
        
        /* シェイププレビューのスタイル */
        .shape-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 200px;
            margin: 20px 0;
        }
        
        .shape {
            transition: transform 0.3s;
        }
        
        .shape:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="container">
            <h1 class="display-4 fw-bold mb-3">PptxGenJS テンプレートギャラリー</h1>
            <p class="lead">スライドをWebでプレビューしてからダウンロード</p>
        </div>
    </div>

    <div class="container">
        <!-- チャートテンプレート -->
        <div class="template-category">
            <h2 class="category-title">📊 チャート</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📊
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">棒グラフ</h5>
                            <p class="card-text">売上データや比較分析に最適な棒グラフテンプレート</p>
                            <button class="btn btn-preview" onclick="previewChart('bar')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateChart('bar')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📈
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">折れ線グラフ</h5>
                            <p class="card-text">時系列データやトレンド分析用の折れ線グラフ</p>
                            <button class="btn btn-preview" onclick="previewChart('line')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateChart('line')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            🥧
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">円グラフ</h5>
                            <p class="card-text">割合や構成を視覚化する円グラフ</p>
                            <button class="btn btn-preview" onclick="previewChart('pie')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateChart('pie')">ダウンロード</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSON to PPTX コンバーター -->
        <div class="template-category">
            <h2 class="category-title">🚀 JSONからPPTX生成</h2>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card template-card">
                        <div class="template-image">
                            📊
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">コンサルティング評価レポート</h5>
                            <p class="card-text">JSONデータから自動生成されるコンサルティング評価レポート（テーブル機能の改善版テスト）</p>
                            <button class="btn btn-demo" onclick="generateConsultingReport()">🔥 PPTX生成</button>
                            <div class="code-preview">
                                <strong>📁 含まれる内容:</strong><br>
                                • 評価の背景とアプローチ（詳細テーブル）<br>
                                • 評価フレームワークと成果<br>
                                • 強み・弱み分析<br>
                                • 根本課題の特定<br>
                                • 推奨アクションプラン
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card template-card">
                        <div class="template-image">
                            ⚙️
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">テーブル生成の改善点</h5>
                            <p class="card-text">元のコードで発生していたテーブル生成問題を修正した実装</p>
                            <div class="code-preview">
                                <strong>🔧 修正内容:</strong><br>
                                • <code>element.data</code> プロパティ対応<br>
                                • パーセンテージ座標の正確な変換<br>
                                • スタイルとオプションの統合<br>
                                • セル色処理の改善<br>
                                • エラーハンドリングの強化
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- テーブルテンプレート -->
        <div class="template-category">
            <h2 class="category-title">📋 テーブル</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📋
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">基本テーブル</h5>
                            <p class="card-text">シンプルで見やすい基本的なテーブルレイアウト</p>
                            <button class="btn btn-preview" onclick="previewTable('basic')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateTable('basic')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📊
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">スタイル付きテーブル</h5>
                            <p class="card-text">色分けやフォーマットが適用されたテーブル</p>
                            <button class="btn btn-preview" onclick="previewTable('styled')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateTable('styled')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📈
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">データテーブル</h5>
                            <p class="card-text">大量のデータを整理して表示するテーブル</p>
                            <button class="btn btn-preview" onclick="previewTable('data')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateTable('data')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📝
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">評価と課題</h5>
                            <p class="card-text">項目ごとの評価と課題をまとめたレポート用テーブル</p>
                            <button class="btn btn-preview" onclick="previewTable('evaluation')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateTable('evaluation')">ダウンロード</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- シェイプ・図形テンプレート -->
        <div class="template-category">
            <h2 class="category-title">🔷 シェイプ・図形</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            🔷
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">基本図形</h5>
                            <p class="card-text">円、四角、三角などの基本的な図形</p>
                            <button class="btn btn-preview" onclick="previewShape('basic')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateShape('basic')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📐
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">フローチャート</h5>
                            <p class="card-text">プロセスや手順を示すフローチャート図形</p>
                            <button class="btn btn-preview" onclick="previewShape('flowchart')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateShape('flowchart')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            🎨
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">カスタム図形</h5>
                            <p class="card-text">独自のデザインやパターンの図形</p>
                            <button class="btn btn-preview" onclick="previewShape('custom')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateShape('custom')">ダウンロード</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- テキストテンプレート -->
        <div class="template-category">
            <h2 class="category-title">📝 テキスト</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📝
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">タイトルスライド</h5>
                            <p class="card-text">インパクトのあるタイトルスライドのテンプレート</p>
                            <button class="btn btn-preview" onclick="previewText('title')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateText('title')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📄
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">箇条書きリスト</h5>
                            <p class="card-text">情報を整理して表示する箇条書きレイアウト</p>
                            <button class="btn btn-preview" onclick="previewText('bullets')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateText('bullets')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            💬
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">引用文</h5>
                            <p class="card-text">印象的な引用文を表示するテンプレート</p>
                            <button class="btn btn-preview" onclick="previewText('quote')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateText('quote')">ダウンロード</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIプレゼンテーションテンプレート -->
        <div class="template-category">
            <h2 class="category-title">🤖 AIプレゼンテーション</h2>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card template-card">
                        <div class="template-image">
                            🤖
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">AIが拓く未来</h5>
                            <p class="card-text">AIをテーマにした包括的なプレゼンテーション（5スライド構成）</p>
                            <button class="btn btn-preview" onclick="previewAI('future')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateAI('future')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card template-card">
                        <div class="template-image">
                            🌟
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">技術革新と社会変革</h5>
                            <p class="card-text">革新的技術の社会実装をテーマにしたプレゼンテーション</p>
                            <button class="btn btn-preview" onclick="previewAI('innovation')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateAI('innovation')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card template-card">
                        <div class="template-image">
                            📊
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">戦略的意思決定フレームワーク</h5>
                            <p class="card-text">コンサル資料評価のための包括的なフレームワーク（5スライド構成）</p>
                            <button class="btn btn-preview" onclick="previewAI('strategy')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateAI('strategy')">ダウンロード</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSONベースPPTX生成テンプレート -->
        <div class="template-category">
            <h2 class="category-title">📄 JSONベースPPTX生成</h2>
            <div class="row g-4">
                <div class="col-md-12">
                    <div class="card template-card">
                        <div class="card-body">
                            <h5 class="card-title">JSONからPPTX生成</h5>
                            <p class="card-text">構造化されたJSONデータから高機能なPPTXファイルを生成します</p>
                            
                            <!-- JSON入力エリア -->
                            <div class="mb-3">
                                <label for="jsonInput" class="form-label">JSONデータ入力:</label>
                                <textarea class="form-control" id="jsonInput" rows="15" placeholder="JSONデータをここに貼り付けてください...">
{
  "title": "AI技術の最新動向",
  "author": "AI Research Team",
  "company": "Tech Innovation Lab",
  "layout": "LAYOUT_16x9",
  "slides": [
    {
      "slideIndex": 0,
      "topic": "AI技術の革命",
      "background": {
        "type": "gradient",
        "colors": ["667eea", "764ba2"],
        "angle": 135
      },
      "elements": [
        {
          "type": "text",
          "textType": "title",
          "content": "AI技術の革命",
          "options": {
            "x": 5,
            "y": 35,
            "w": 90,
            "h": 15
          },
          "style": {
            "fontSize": 48,
            "bold": true,
            "color": "FFFFFF",
            "align": "center"
          }
        },
        {
          "type": "text",
          "textType": "subtitle", 
          "content": "次世代テクノロジーの可能性",
          "options": {
            "x": 5,
            "y": 52,
            "w": 90,
            "h": 10
          },
          "style": {
            "fontSize": 24,
            "color": "E0E0E0",
            "align": "center"
          }
        }
      ]
    },
    {
      "slideIndex": 1,
      "topic": "AI活用事例",
      "background": "#F8F9FA",
      "elements": [
        {
          "type": "text",
          "textType": "title",
          "content": "AI活用事例",
          "options": {
            "x": 8,
            "y": 15,
            "w": 84,
            "h": 18
          },
          "style": {
            "fontSize": 48,
            "bold": true,
            "color": "0D47A1"
          }
        },
        {
          "type": "chart",
          "chartType": "bar",
          "data": [
            {
              "name": "効果測定",
              "labels": ["医療", "金融", "製造", "小売"],
              "values": [85, 72, 68, 58]
            }
          ],
          "options": {
            "x": 10,
            "y": 40,
            "w": 80,
            "h": 50
          },
          "chartOptions": {
            "title": "業界別AI導入効果（%）",
            "showValue": true,
            "chartColors": ["4285F4", "34A853", "FBBC04", "EA4335"]
          }
        }
      ]
    },
    {
      "slideIndex": 2,
      "topic": "技術比較表",
      "background": "#FFFFFF",
      "elements": [
        {
          "type": "text",
          "textType": "title",
          "content": "AI技術比較",
          "options": {
            "x": 5,
            "y": 10,
            "w": 90,
            "h": 15
          },
          "style": {
            "fontSize": 36,
            "bold": true,
            "color": "1F2937",
            "align": "center"
          }
        },
        {
          "type": "table",
          "data": [
            [
              {"text": "技術", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
              {"text": "精度", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
              {"text": "処理速度", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
              {"text": "コスト", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}}
            ],
            ["機械学習", "85%", "高速", "中"],
            ["深層学習", "92%", "中速", "高"],
            ["強化学習", "88%", "低速", "高"]
          ],
          "options": {
            "x": 10,
            "y": 30,
            "w": 80,
            "h": 60
          },
          "tableOptions": {
            "border": {"type": "solid", "pt": 1, "color": "CCCCCC"},
            "fontSize": 16,
            "align": "center"
          }
        }
      ]
    }
  ]
}</textarea>
                            </div>
                            
                            <div class="d-flex gap-2 mb-3">
                                <button class="btn btn-preview" onclick="previewFromJSON()">プレビュー</button>
                                <button class="btn btn-demo" onclick="generateFromJSON()">ダウンロード</button>
                                <button class="btn btn-secondary" onclick="loadSampleJSON()">サンプル読み込み</button>
                                <button class="btn btn-warning" onclick="validateJSON()">JSON検証</button>
                            </div>
                            
                            <div id="jsonValidationResult" class="alert" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 高度な機能テンプレート -->
        <div class="template-category">
            <h2 class="category-title">⚡ 高度な機能</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            🎨
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">高度な図形機能</h5>
                            <p class="card-text">カスタムジオメトリ、影効果、グラデーション、回転を含む図形</p>
                            <button class="btn btn-preview" onclick="previewAdvanced('shapes')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateAdvanced('shapes')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            🖼️
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">画像処理機能</h5>
                            <p class="card-text">リサイズ、クロッピング、透明度、回転、SVGサポート</p>
                            <button class="btn btn-preview" onclick="previewAdvanced('images')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateAdvanced('images')">ダウンロード</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card template-card">
                        <div class="template-image">
                            📊
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">高度なチャート</h5>
                            <p class="card-text">3Dチャート、マルチシリーズ、カスタムスタイリング</p>
                            <button class="btn btn-preview" onclick="previewAdvanced('charts')">プレビュー</button>
                            <button class="btn btn-demo" onclick="generateAdvanced('charts')">ダウンロード</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- コード表示エリア -->
        <div class="template-category">
            <h2 class="category-title">💻 コードプレビュー</h2>
            <div id="codePreview" class="code-preview">
                <p class="text-muted">ボタンをクリックしてコード例を表示</p>
            </div>
        </div>
    </div>

    <!-- プレビューモーダル -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewModalLabel">スライドプレビュー</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="slide-preview-container">
                        <div class="slide-preview">
                            <div id="slideContent" class="slide-content">
                                <!-- プレビューコンテンツがここに表示されます -->
                            </div>
                        </div>
                    </div>
                    <div class="slide-navigation">
                        <button class="btn btn-secondary" onclick="previousSlide()" id="prevBtn">前へ</button>
                        <span id="slideIndicator">1 / 1</span>
                        <button class="btn btn-secondary" onclick="nextSlide()" id="nextBtn">次へ</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
                    <button type="button" class="btn btn-primary" id="downloadBtn">ダウンロード</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js for chart previews -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PptxGenJS ライブラリ -->
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@latest/dist/pptxgen.bundle.js"></script>
    
    <script>
        let currentSlides = [];
        let currentSlideIndex = 0;
        let currentType = '';
        let currentSubType = '';
        
        // プレビューモーダルを表示
        function showPreviewModal(title) {
            document.getElementById('previewModalLabel').textContent = title;
            const modal = new bootstrap.Modal(document.getElementById('previewModal'));
            modal.show();
        }
        
        // チャートプレビュー関数
        function previewChart(type) {
            currentType = 'chart';
            currentSubType = type;
            currentSlides = [];
            
            switch(type) {
                case 'bar':
                    currentSlides.push({
                        title: '月別売上グラフ',
                        content: `
                            <h2 class="mb-4">月別売上グラフ</h2>
                            <div class="chart-container">
                                <canvas id="barChart"></canvas>
                            </div>
                        `,
                        init: () => {
                            const ctx = document.getElementById('barChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: ['1月', '2月', '3月', '4月'],
                                    datasets: [{
                                        label: '売上データ',
                                        data: [1500, 2500, 2000, 3000],
                                        backgroundColor: '#4472C4'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false
                                }
                            });
                        }
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addChart(pptx.ChartType.bar, [
    {
        name: '売上データ',
        labels: ['1月', '2月', '3月', '4月'],
        values: [1500, 2500, 2000, 3000]
    }
], {
    x: 1, y: 1, w: 8, h: 4,
    title: '月別売上グラフ'
});
pptx.writeFile({ fileName: 'bar-chart.pptx' });`);
                    break;
                    
                case 'line':
                    currentSlides.push({
                        title: '四半期トレンド',
                        content: `
                            <h2 class="mb-4">四半期トレンド</h2>
                            <div class="chart-container">
                                <canvas id="lineChart"></canvas>
                            </div>
                        `,
                        init: () => {
                            const ctx = document.getElementById('lineChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                                    datasets: [{
                                        label: 'トレンド',
                                        data: [100, 150, 130, 180],
                                        borderColor: '#4472C4',
                                        tension: 0.1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false
                                }
                            });
                        }
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addChart(pptx.ChartType.line, [
    {
        name: 'トレンド',
        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
        values: [100, 150, 130, 180]
    }
], {
    x: 1, y: 1, w: 8, h: 4,
    title: '四半期トレンド'
});
pptx.writeFile({ fileName: 'line-chart.pptx' });`);
                    break;
                    
                case 'pie':
                    currentSlides.push({
                        title: '市場シェア分析',
                        content: `
                            <h2 class="mb-4">市場シェア分析</h2>
                            <div class="chart-container">
                                <canvas id="pieChart"></canvas>
                            </div>
                        `,
                        init: () => {
                            const ctx = document.getElementById('pieChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'pie',
                                data: {
                                    labels: ['製品A', '製品B', '製品C', 'その他'],
                                    datasets: [{
                                        data: [35, 25, 20, 20],
                                        backgroundColor: ['#4472C4', '#ED7D31', '#A5A5A5', '#FFC000']
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false
                                }
                            });
                        }
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addChart(pptx.ChartType.pie, [
    {
        name: '市場シェア',
        labels: ['製品A', '製品B', '製品C', 'その他'],
        values: [35, 25, 20, 20]
    }
], {
    x: 1, y: 1, w: 6, h: 4,
    title: '市場シェア分析'
});
pptx.writeFile({ fileName: 'pie-chart.pptx' });`);
                    break;
            }
            
            currentSlideIndex = 0;
            updateSlide();
            showPreviewModal(`チャートプレビュー - ${type}`);
        }
        
        // テーブルプレビュー関数
        function previewTable(type) {
            currentType = 'table';
            currentSubType = type;
            currentSlides = [];
            
            switch(type) {
                case 'basic':
                    currentSlides.push({
                        title: '基本テーブル',
                        content: `
                            <h2 class="mb-4">基本テーブル</h2>
                            <table class="preview-table">
                                <tr>
                                    <th>項目</th>
                                    <th>数値</th>
                                    <th>状態</th>
                                </tr>
                                <tr>
                                    <td>売上</td>
                                    <td>¥1,000,000</td>
                                    <td>達成</td>
                                </tr>
                                <tr>
                                    <td>コスト</td>
                                    <td>¥500,000</td>
                                    <td>予算内</td>
                                </tr>
                                <tr>
                                    <td>利益</td>
                                    <td>¥500,000</td>
                                    <td>良好</td>
                                </tr>
                            </table>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addTable([
    ['項目', '数値', '状態'],
    ['売上', '¥1,000,000', '達成'],
    ['コスト', '¥500,000', '予算内'],
    ['利益', '¥500,000', '良好']
], {
    x: 1, y: 1, w: 8, h: 3
});
pptx.writeFile({ fileName: 'basic-table.pptx' });`);
                    break;
                    
                case 'styled':
                    currentSlides.push({
                        title: 'スタイル付きテーブル',
                        content: `
                            <h2 class="mb-4">スタイル付きテーブル</h2>
                            <table class="preview-table">
                                <tr>
                                    <th style="background-color: #363636; color: white;">ヘッダー1</th>
                                    <th style="background-color: #363636; color: white;">ヘッダー2</th>
                                </tr>
                                <tr>
                                    <td>データ1</td>
                                    <td>データ2</td>
                                </tr>
                                <tr>
                                    <td style="background-color: #f0f0f0;">データ3</td>
                                    <td style="background-color: #f0f0f0;">データ4</td>
                                </tr>
                            </table>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addTable([
    [{ text: 'ヘッダー1', options: { fill: '363636', color: 'FFFFFF', bold: true } },
     { text: 'ヘッダー2', options: { fill: '363636', color: 'FFFFFF', bold: true } }],
    ['データ1', 'データ2'],
    ['データ3', 'データ4']
], {
    x: 1, y: 1, w: 8, h: 3,
    border: { pt: 1, color: 'CCCCCC' }
});
pptx.writeFile({ fileName: 'styled-table.pptx' });`);
                    break;
                    
                case 'data':
                    let rows = '<tr><th>ID</th><th>名前</th><th>部門</th><th>売上</th></tr>';
                    for(let i = 1; i <= 10; i++) {
                        rows += `<tr><td>00${i}</td><td>社員${i}</td><td>部門${i % 3 + 1}</td><td>¥${i * 100000}</td></tr>`;
                    }
                    currentSlides.push({
                        title: 'データテーブル',
                        content: `
                            <h2 class="mb-4">データテーブル</h2>
                            <div style="overflow-y: auto; max-height: 300px;">
                                <table class="preview-table">
                                    ${rows}
                                </table>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
let rows = [['ID', '名前', '部門', '売上']];
for(let i = 1; i <= 10; i++) {
    rows.push([\`00\${i}\`, \`社員\${i}\`, \`部門\${i % 3 + 1}\`, \`¥\${i * 100000}\`]);
}
slide.addTable(rows, {
    x: 0.5, y: 0.5, w: 9, h: 5,
    fontSize: 10
});
pptx.writeFile({ fileName: 'data-table.pptx' });`);
                    break;
                case 'evaluation':
                    currentSlides.push({
                        title: '評価と課題',
                        content: `
                            <div style="padding: 20px;">
                                <h2 style="font-size: 1.6rem; font-weight: bold;">4-1. 定性評価</h2>
                                <h3 style="font-size: 1.2rem; font-weight: bold; margin-top: 1rem;">実施事項に対する評価と課題</h3>
                                <p style="font-size: 0.9rem; margin-top: 1rem;">各項目について一定の成果は得られたものの、サービス利用の拡大とデータ収集、利活用の促進に向け、抽出された課題への対応を検討し、今後実施していく方針です。</p>
                                <table class="preview-table" style="font-size: 0.75rem; margin-top: 1.5rem;">
                                    <thead>
                                        <tr>
                                            <th style="background-color: #92D050; color: #333; width: 15%;">項目</th>
                                            <th style="background-color: #92D050; color: #333; width: 25%;">評価</th>
                                            <th style="background-color: #92D050; color: #333; width: 60%;">課題</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td rowspan="2" style="background-color: #E2EFDA; text-align: center; font-weight: bold; vertical-align: middle;">匿名加工情報<br>の収集</td>
                                            <td rowspan="2" style="background-color: #F8F9FA; vertical-align: middle;">匿名加工情報による収集追加により、データ数は増加</td>
                                            <td style="background-color: #F8F9FA;"><strong>匿名加工方法の見直し・更新</strong><br>・有識者の助言のもと適法に定義済み<br>・ただし今後、データ利活用時に組み合わせる情報により個人が特定される恐れもあり都度データ粒度の精査、検討等が必要</td>
                                        </tr>
                                        <tr>
                                            <td style="background-color: #F8F9FA;"><strong>加工事業者の分離</strong><br>・匿名加工処理者とデータ利用者が同一事業者となる点は、業務環境を完全に分離し、それぞれ専任の担当者を配置する等の運用対応により問題なしとしたものの、運用体制の変更等の際には都度チェックが必要</td>
                                        </tr>
                                        <tr>
                                            <td rowspan="2" style="background-color: #E2EFDA; text-align: center; font-weight: bold; vertical-align: middle;">分析機能<br>の提供</td>
                                            <td rowspan="2" style="background-color: #F8F9FA; vertical-align: middle;">概況を端的に把握可能なダッシュボードでのレポーティングを実施</td>
                                            <td style="background-color: #F8F9FA;"><strong>利用増の対策検討</strong><br>・利用件数を増加させる施策の検討が必要(レポートの改善、簡易な集計画面の提供等)検討が必要</td>
                                        </tr>
                                        <tr>
                                            <td style="background-color: #F8F9FA;"><strong>データ利活用の高度化検討</strong><br>・テキストデータの分析、AIの利用等、高度な分析実施に向けたデータ整備と実施方法の検討が必要</td>
                                        </tr>
                                        <tr>
                                            <td rowspan="2" style="background-color: #E2EFDA; text-align: center; font-weight: bold; vertical-align: middle;">決済機能<br>の提供</td>
                                            <td rowspan="2" style="background-color: #F8F9FA; vertical-align: middle;">2地域でそれぞれ決済サービスの提供体制、運用スキームを構築、実証し、示唆を収集</td>
                                            <td style="background-color: #F8F9FA;"><strong>導入店舗数の拡大</strong><br>・店舗数の拡大に向け、導入の抵抗となる店舗端末の用意、決済手数料、運用費に対し、導入メリットの提示等、対応策の検討が必要</td>
                                        </tr>
                                        <tr>
                                            <td style="background-color: #F8F9FA;"><strong>ユーザ利用の拡大</strong><br>・ユーザへのプロモーション、利用メリット、インセンティブの提示等、認知度の向上と利用促進策の検討、実施が必要</td>
                                        </tr>
                                        <tr>
                                            <td rowspan="2" style="background-color: #E2EFDA; text-align: center; font-weight: bold; vertical-align: middle;">海外法令の<br>調査と対応</td>
                                            <td rowspan="2" style="background-color: #F8F9FA; vertical-align: middle;">最新動向を把握し、有識者のアドバイスのもと対応を実施</td>
                                            <td style="background-color: #F8F9FA;"><strong>EEA国籍ユーザデータの扱い</strong><br>・現状、一律破棄としているEEA国籍ユーザのデータについて、サービス利用位置やデータ連携時の位置情報をもとに破棄の判断を実施する仕組みの検討、構築</td>
                                        </tr>
                                        <tr>
                                            <td style="background-color: #F8F9FA;"><strong>ePrivacy規則への対応</strong><br>・協議検討中のePrivacy規則について、施行され次第早急に対応が可能なよう、今後の動向注視を継続し、対応を整理</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div style="text-align: right; font-size: 0.8rem; margin-top: 10px; color: #666;">33</div>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();

slide.addText("4-1. 定性評価", { x: 0.5, y: 0.25, w: "90%", h: 0.5, fontSize: 32, bold: true });
slide.addText("実施事項に対する評価と課題", { x: 0.5, y: 0.75, w: "90%", h: 0.5, fontSize: 24, bold: true });
slide.addText("各項目について一定の成果は得られたものの、サービス利用の拡大とデータ収集、利活用の促進に向け、抽出された課題への対応を検討し、今後実施していく方針です。", { x: 0.5, y: 1.5, w: "90%", h: 0.6, fontSize: 14 });

const commonCellOpts = { border: { type: 'solid', pt: 1, color: 'CCCCCC' }, valign: 'middle', fontSize: 12 };
const headerOpts = { ...commonCellOpts, fill: { color: '92D050' }, color: '333333', bold: true, align: 'center', fontSize: 14 };
const itemCellOpts = { ...commonCellOpts, fill: { color: 'E2EFDA' }, align: 'center' };
const evalCellOpts = { ...commonCellOpts, fill: { color: 'E2EFDA' } };

const tableData = [
  [{ text: "項目", options: headerOpts }, { text: "評価", options: headerOpts }, { text: "課題", options: headerOpts }],
  [
    { text: "匿名加工情報\\nの収集", options: { ...itemCellOpts, rowspan: 2 } },
    { text: "匿名加工情報による収集追加により、データ数は増加", options: { ...evalCellOpts, rowspan: 2 } },
    { text: [{ text: '匿名加工方法の見直し・更新', options: { bold: true } }, { text: '\\n・有識者の助言のもと適法に定義済み', options: { breakLine: true } }, { text: '\\n・ただし今後、データ利活用時に組み合わせる情報により個人が特定される恐れもあり都度データ粒度の精査、検討等が必要', options: { breakLine: true } }], options: commonCellOpts },
  ],
  [ { text: [{ text: '加工事業者の分離', options: { bold: true } }, { text: '\\n・匿名加工処理者とデータ利用者が同一事業者となる点は、業務環境を完全に分離し、それぞれ専任の担当者を配置する等の運用対応により問題なしとしたものの、運用体制の変更等の際には都度チェックが必要', options: { breakLine: true } }], options: commonCellOpts } ],
  [
    { text: "分析機能\\nの提供", options: { ...itemCellOpts, rowspan: 2 } },
    { text: "概況を端的に把握可能なダッシュボードでのレポーティングを実施", options: { ...evalCellOpts, rowspan: 2 } },
    { text: [{ text: '利用増の対策検討', options: { bold: true } }, { text: '\\n・利用件数を増加させる施策の検討が必要(レポートの改善、簡易な集計画面の提供等)検討が必要', options: { breakLine: true } }], options: commonCellOpts },
  ],
  [ { text: [{ text: 'データ利活用の高度化検討', options: { bold: true } }, { text: '\\n・テキストデータの分析、AIの利用等、高度な分析実施に向けたデータ整備と実施方法の検討が必要', options: { breakLine: true } }], options: commonCellOpts } ],
  [
    { text: "決済機能\\nの提供", options: { ...itemCellOpts, rowspan: 2 } },
    { text: "2地域でそれぞれ決済サービスの提供体制、運用スキームを構築、実証し、示唆を収集", options: { ...evalCellOpts, rowspan: 2 } },
    { text: [{ text: '導入店舗数の拡大', options: { bold: true } }, { text: '\\n・店舗数の拡大に向け、導入の抵抗となる店舗端末の用意、決済手数料、運用費に対し、導入メリットの提示等、対応策の検討が必要', options: { breakLine: true } }], options: commonCellOpts },
  ],
  [ { text: [{ text: 'ユーザ利用の拡大', options: { bold: true } }, { text: '\\n・ユーザへのプロモーション、利用メリット、インセンティブの提示等、認知度の向上と利用促進策の検討、実施が必要', options: { breakLine: true } }], options: commonCellOpts } ],
  [
    { text: "海外法令の\\n調査と対応", options: { ...itemCellOpts, rowspan: 2 } },
    { text: "最新動向を把握し、有識者のアドバイスのもと対応を実施", options: { ...evalCellOpts, rowspan: 2 } },
    { text: [{ text: 'EEA国籍ユーザデータの扱い', options: { bold: true } }, { text: '\\n・現状、一律破棄としているEEA国籍ユーザのデータについて、サービス利用位置やデータ連携時の位置情報をもとに破棄の判断を実施する仕組みの検討、構築', options: { breakLine: true } }], options: commonCellOpts },
  ],
  [ { text: [{ text: 'ePrivacy規則への対応', options: { bold: true } }, { text: '\\n・協議検討中のePrivacy規則について、施行され次第早急に対応が可能なよう、今後の動向注視を継続し、対応を整理', options: { breakLine: true } }], options: commonCellOpts } ]
];

slide.addTable(tableData, { x: 0.5, y: 2.3, w: 9.0, colW: [1.5, 2.5, 5.0] });
slide.addText('33', { x: 9.2, y: 7.1, w: 0.5, h: 0.3, align: 'right', fontSize: 10 });

pptx.writeFile({ fileName: 'Evaluation_Slide.pptx' });`);
                    break;
            }
            
            currentSlideIndex = 0;
            updateSlide();
            showPreviewModal(`テーブルプレビュー - ${type}`);
        }
        
        // シェイププレビュー関数
        function previewShape(type) {
            currentType = 'shape';
            currentSubType = type;
            currentSlides = [];
            
            switch(type) {
                case 'basic':
                    currentSlides.push({
                        title: '基本図形',
                        content: `
                            <h2 class="mb-4">基本図形</h2>
                            <div class="shape-container">
                                <svg width="150" height="150" class="shape">
                                    <rect x="25" y="25" width="100" height="100" fill="#FF0000"/>
                                </svg>
                                <svg width="150" height="150" class="shape">
                                    <circle cx="75" cy="75" r="50" fill="#00FF00"/>
                                </svg>
                                <svg width="150" height="150" class="shape">
                                    <polygon points="75,25 125,125 25,125" fill="#0000FF"/>
                                </svg>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addShape(pptx.ShapeType.rect, { x: 1, y: 1, w: 2, h: 2, fill: 'FF0000' });
slide.addShape(pptx.ShapeType.ellipse, { x: 4, y: 1, w: 2, h: 2, fill: '00FF00' });
slide.addShape(pptx.ShapeType.triangle, { x: 7, y: 1, w: 2, h: 2, fill: '0000FF' });
pptx.writeFile({ fileName: 'basic-shapes.pptx' });`);
                    break;
                    
                case 'flowchart':
                    currentSlides.push({
                        title: 'フローチャート',
                        content: `
                            <h2 class="mb-4">フローチャート</h2>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                                <div style="background: #4472C4; color: white; padding: 20px 40px; border-radius: 5px;">
                                    開始
                                </div>
                                <div style="font-size: 30px;">→</div>
                                <div style="background: #FFC000; padding: 20px 40px; transform: rotate(45deg);">
                                    <div style="transform: rotate(-45deg);">条件</div>
                                </div>
                                <div style="font-size: 30px;">→</div>
                                <div style="background: #70AD47; color: white; padding: 20px 40px; border-radius: 5px;">
                                    終了
                                </div>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
// プロセスボックス
slide.addShape(pptx.ShapeType.rect, { x: 1, y: 1, w: 2, h: 1, fill: '4472C4' });
slide.addText('開始', { x: 1, y: 1, w: 2, h: 1, align: 'center', valign: 'middle', color: 'FFFFFF' });
// 判断ボックス
slide.addShape(pptx.ShapeType.diamond, { x: 4, y: 0.5, w: 2, h: 2, fill: 'FFC000' });
slide.addText('条件', { x: 4, y: 0.5, w: 2, h: 2, align: 'center', valign: 'middle' });
pptx.writeFile({ fileName: 'flowchart.pptx' });`);
                    break;
                    
                case 'custom':
                    currentSlides.push({
                        title: 'カスタムデザイン',
                        content: `
                            <h2 class="mb-4">カスタムデザイン</h2>
                            <div style="position: relative; height: 300px;">
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #E7E6E6; padding: 40px 100px; border-radius: 20px;">
                                    <h3 style="margin: 0;">カスタムデザイン</h3>
                                </div>
                                <svg width="100" height="100" style="position: absolute; top: 20px; left: 20px;">
                                    <polygon points="50,15 61,35 82,35 67,50 73,71 50,57 27,71 33,50 18,35 39,35" fill="#FFD700"/>
                                </svg>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addShape(pptx.ShapeType.roundRect, { x: 2, y: 1, w: 6, h: 3, fill: 'E7E6E6', rectRadius: 0.2 });
slide.addShape(pptx.ShapeType.star5, { x: 0.5, y: 0.5, w: 1, h: 1, fill: 'FFD700' });
slide.addText('カスタムデザイン', { x: 2, y: 2, w: 6, h: 1, fontSize: 24, bold: true, align: 'center' });
pptx.writeFile({ fileName: 'custom-shapes.pptx' });`);
                    break;
            }
            
            currentSlideIndex = 0;
            updateSlide();
            showPreviewModal(`シェイププレビュー - ${type}`);
        }
        
        // テキストプレビュー関数
        function previewText(type) {
            currentType = 'text';
            currentSubType = type;
            currentSlides = [];
            
            switch(type) {
                case 'title':
                    currentSlides.push({
                        title: 'タイトルスライド',
                        content: `
                            <div style="text-align: center; margin-top: 80px;">
                                <h1 style="font-size: 48px; font-weight: bold; color: #363636; margin-bottom: 30px;">
                                    インパクトのあるタイトル
                                </h1>
                                <h2 style="font-size: 24px; color: #666666;">
                                    サブタイトルやキャッチコピー
                                </h2>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addText('インパクトのあるタイトル', {
    x: 0.5, y: 1.5, w: 9, h: 2,
    fontSize: 48, bold: true,
    align: 'center',
    color: '363636'
});
slide.addText('サブタイトルやキャッチコピー', {
    x: 0.5, y: 3.5, w: 9, h: 1,
    fontSize: 24,
    align: 'center',
    color: '666666'
});
pptx.writeFile({ fileName: 'title-slide.pptx' });`);
                    break;
                    
                case 'bullets':
                    currentSlides.push({
                        title: '箇条書きリスト',
                        content: `
                            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 30px;">重要なポイント</h2>
                            <ul style="font-size: 18px; line-height: 1.8;">
                                <li>最初のポイント</li>
                                <li>次のポイント
                                    <ul>
                                        <li>サブポイント1</li>
                                        <li>サブポイント2</li>
                                    </ul>
                                </li>
                                <li>最後のポイント</li>
                            </ul>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addText('重要なポイント', { x: 0.5, y: 0.5, fontSize: 24, bold: true });
slide.addText([
    { text: '• 最初のポイント', options: { bullet: true, indentLevel: 0 } },
    { text: '• 次のポイント', options: { bullet: true, indentLevel: 0 } },
    { text: '  ◦ サブポイント1', options: { bullet: true, indentLevel: 1 } },
    { text: '  ◦ サブポイント2', options: { bullet: true, indentLevel: 1 } },
    { text: '• 最後のポイント', options: { bullet: true, indentLevel: 0 } }
], {
    x: 0.5, y: 1.5, w: 9, h: 4,
    fontSize: 18
});
pptx.writeFile({ fileName: 'bullet-list.pptx' });`);
                    break;
                    
                case 'quote':
                    currentSlides.push({
                        title: '引用文',
                        content: `
                            <div style="background: #F5F5F5; border-left: 5px solid #4472C4; padding: 40px; margin: 40px 20px;">
                                <p style="font-size: 20px; font-style: italic; text-align: center; margin-bottom: 20px;">
                                    "成功とは、失敗から失敗へと情熱を失わずに進む能力である"
                                </p>
                                <p style="text-align: right; font-size: 16px; color: #666;">
                                    - ウィンストン・チャーチル
                                </p>
                            </div>
                        `
                    });
                    showCode(`let pptx = new PptxGenJS();
let slide = pptx.addSlide();
slide.addShape(pptx.ShapeType.rect, {
    x: 1, y: 1.5, w: 8, h: 3,
    fill: 'F5F5F5',
    line: { color: '4472C4', width: 3 }
});
slide.addText('"成功とは、失敗から失敗へと情熱を失わずに進む能力である"', {
    x: 1.5, y: 2, w: 7, h: 1.5,
    fontSize: 20,
    italic: true,
    align: 'center',
    valign: 'middle'
});
slide.addText('- ウィンストン・チャーチル', {
    x: 1.5, y: 3.5, w: 7, h: 0.5,
    fontSize: 16,
    align: 'right'
});
pptx.writeFile({ fileName: 'quote-slide.pptx' });`);
                    break;
            }
            
            currentSlideIndex = 0;
            updateSlide();
            showPreviewModal(`テキストプレビュー - ${type}`);
        }
        
        // AIプレゼンテーションプレビュー関数
        function previewAI(type) {
            currentType = 'ai';
            currentSubType = type;
            currentSlides = [];
            
            switch(type) {
                case 'future':
                    currentSlides.push({
                        title: 'AIが拓く未来へようこそ',
                        content: `
                            <div style="background: linear-gradient(135deg, #1A365D, #2B6CB0); color: white; height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px;">
                                <h1 style="font-size: 48px; font-weight: bold; margin-bottom: 30px;">
                                    AIが拓く未来へようこそ
                                </h1>
                                <h2 style="font-size: 24px; color: #E0E0E0;">
                                    テクノロジーがもたらす変革と可能性
                                </h2>
                            </div>
                        `
                    });
                    break;
                    
                case 'innovation':
                    currentSlides.push({
                        title: '技術革新と社会変革',
                        content: `
                            <div style="padding: 40px; background: white;">
                                <h1 style="font-size: 36px; font-weight: bold; color: #1A365D; text-align: center; margin-bottom: 40px;">
                                    技術革新と社会変革
                                </h1>
                                <div style="display: flex; gap: 30px; justify-content: center;">
                                    <div style="flex: 1; max-width: 300px; padding: 30px; background: #E3F2FD; border: 1px solid #2196F3; border-radius: 12px; text-align: center;">
                                        <h3 style="font-size: 24px; font-weight: bold; color: #1565C0; margin-bottom: 20px;">🤖 AI革命</h3>
                                        <p style="font-size: 16px; color: #333333;">機械学習とディープラーニングが産業構造を根本的に変革</p>
                                    </div>
                                    <div style="flex: 1; max-width: 300px; padding: 30px; background: #E8F5E8; border: 1px solid #4CAF50; border-radius: 12px; text-align: center;">
                                        <h3 style="font-size: 24px; font-weight: bold; color: #2E7D32; margin-bottom: 20px;">🌱 持続可能な未来</h3>
                                        <p style="font-size: 16px; color: #333333;">環境技術とスマートシティが次世代の生活基盤を構築</p>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                    break;
                    
                case 'strategy':
                    // スライド1: タイトルスライド
                    currentSlides.push({
                        title: '戦略的意思決定フレームワーク',
                        content: `
                            <div style="background: white; padding: 60px 40px; text-align: center; height: 400px; display: flex; flex-direction: column; justify-content: center;">
                                <h1 style="font-size: 38px; font-weight: bold; color: #1A365D; margin-bottom: 20px; line-height: 1.2;">
                                    意思決定を3倍速にする資料評価フレームワーク「CLEAR」
                                </h1>
                                <div style="width: 120px; height: 2px; background: #2E86C1; margin: 20px auto;"></div>
                                <h2 style="font-size: 24px; color: #1A365D; margin-top: 30px;">
                                    評価時間90%削減、意思決定精度300%向上
                                </h2>
                            </div>
                        `
                    });
                    
                    // スライド2: 質の低い資料のリスク
                    currentSlides.push({
                        title: 'なぜ今、資料評価が重要なのか？',
                        content: `
                            <div style="background: white; padding: 40px; height: 400px;">
                                <h1 style="font-size: 34px; font-weight: bold; color: #1A365D; text-align: center; margin-bottom: 40px;">
                                    なぜ今、資料評価が重要なのか？<br>質の低い資料がもたらす3大リスク
                                </h1>
                                <div style="display: flex; justify-content: space-around; margin-top: 60px;">
                                    <div style="text-align: center; flex: 1;">
                                        <div style="width: 80px; height: 80px; background: #EBF1FA; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px;">⚠️</div>
                                        <h3 style="font-size: 16px; font-weight: bold; color: #1A365D;">見過ごされたコスト</h3>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <div style="width: 80px; height: 80px; background: #EBF1FA; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px;">⚡</div>
                                        <h3 style="font-size: 16px; font-weight: bold; color: #1A365D;">見えざる3大リスク</h3>
                                    </div>
                                    <div style="text-align: center; flex: 1;">
                                        <div style="width: 80px; height: 80px; background: #EBF1FA; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px;">📊</div>
                                        <h3 style="font-size: 16px; font-weight: bold; color: #1A365D;">評価の重要性</h3>
                                    </div>
                                </div>
                                <p style="text-align: center; color: #6c757d; font-size: 14px; margin-top: 40px;">
                                    質の低い資料が招く、見過ごされた3つの経営リスク
                                </p>
                            </div>
                        `
                    });
                    
                    // スライド3: C.L.A.フレームワーク
                    currentSlides.push({
                        title: '評価フレームワーク『C.L.A.』',
                        content: `
                            <div style="background: #F0F4F8; padding: 40px; height: 400px;">
                                <h1 style="font-size: 40px; font-weight: bold; color: #1A365D; text-align: center; margin-bottom: 10px;">
                                    評価フレームワーク『C.L.A.』
                                </h1>
                                <h2 style="font-size: 24px; color: #334E68; text-align: center; margin-bottom: 30px;">
                                    3つの視点で本質を見抜く
                                </h2>
                                <div style="display: flex; gap: 20px; justify-content: space-between;">
                                    <div style="flex: 1; background: white; border: 1px solid #D9E2EC; border-radius: 8px; padding: 20px; text-align: center;">
                                        <div style="font-size: 40px; margin-bottom: 15px;">🎯</div>
                                        <h3 style="font-size: 20px; font-weight: bold; color: #1A365D; margin-bottom: 15px;">C: Clarity (明確性)</h3>
                                        <p style="font-size: 14px; color: #334E68; line-height: 1.4;">
                                            提案の目的、範囲、提供価値が誰にでも理解できるよう、明確に定義されているか評価します。
                                        </p>
                                    </div>
                                    <div style="flex: 1; background: white; border: 1px solid #D9E2EC; border-radius: 8px; padding: 20px; text-align: center;">
                                        <div style="font-size: 40px; margin-bottom: 15px;">🔗</div>
                                        <h3 style="font-size: 20px; font-weight: bold; color: #1A365D; margin-bottom: 15px;">L: Logic (論理性)</h3>
                                        <p style="font-size: 14px; color: #334E68; line-height: 1.4;">
                                            主張と根拠の間に矛盾がなく、データに基づいた一貫性のある論理が構築されているか評価します。
                                        </p>
                                    </div>
                                    <div style="flex: 1; background: white; border: 1px solid #D9E2EC; border-radius: 8px; padding: 20px; text-align: center;">
                                        <div style="font-size: 40px; margin-bottom: 15px;">⚡</div>
                                        <h3 style="font-size: 20px; font-weight: bold; color: #1A365D; margin-bottom: 15px;">A: Actionability (実行可能性)</h3>
                                        <p style="font-size: 14px; color: #334E68; line-height: 1.4;">
                                            提案内容が具体的で、現実的なリソースと時間軸の中で実行可能であるかを評価します。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                    
                    // スライド4: ケーススタディ
                    currentSlides.push({
                        title: '実践ケーススタディ',
                        content: `
                            <div style="background: white; padding: 40px; height: 400px;">
                                <h1 style="font-size: 36px; font-weight: bold; color: #1A365D; text-align: center; margin-bottom: 15px;">
                                    実践ケーススタディ：フレームワーク導入の成果
                                </h1>
                                <h2 style="font-size: 18px; color: #4A5568; text-align: center; margin-bottom: 40px;">
                                    AIを活用した評価プロセスで、大幅な業務効率化を達成
                                </h2>
                                <div style="display: flex; gap: 40px; justify-content: center; margin-top: 50px;">
                                    <div style="background: #EBF8FF; padding: 30px; border-radius: 12px; text-align: center; min-width: 200px;">
                                        <h3 style="font-size: 16px; font-weight: bold; color: #2C5282; margin-bottom: 15px;">投資収益率 (ROI)</h3>
                                        <div style="font-size: 44px; font-weight: bold; color: #2B6CB0;">250%</div>
                                    </div>
                                    <div style="background: #EBF8FF; padding: 30px; border-radius: 12px; text-align: center; min-width: 200px;">
                                        <h3 style="font-size: 16px; font-weight: bold; color: #2C5282; margin-bottom: 15px;">評価工数削減</h3>
                                        <div style="font-size: 44px; font-weight: bold; color: #2B6CB0;">45%</div>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                    
                    // スライド5: 実行計画テーブル
                    currentSlides.push({
                        title: 'データ駆動型意思決定への実行計画',
                        content: `
                            <div style="background: white; padding: 40px; height: 400px; overflow-y: auto;">
                                <h1 style="font-size: 32px; font-weight: bold; color: #1A365D; text-align: center; margin-bottom: 30px;">
                                    データ駆動型意思決定へ：次の90日でROIを35%向上させる実行計画
                                </h1>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 20px;">
                                        <thead>
                                            <tr style="background: #EBF1FA;">
                                                <th style="border: 1px solid #ccc; padding: 8px; text-align: center; font-weight: bold;">施策フェーズ</th>
                                                <th style="border: 1px solid #ccc; padding: 8px; text-align: center; font-weight: bold;">主要KPI</th>
                                                <th style="border: 1px solid #ccc; padding: 8px; text-align: center; font-weight: bold;">現状値</th>
                                                <th style="border: 1px solid #ccc; padding: 8px; text-align: center; font-weight: bold;">目標値</th>
                                                <th style="border: 1px solid #ccc; padding: 8px; text-align: center; font-weight: bold;">期待される事業インパクト</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="border: 1px solid #ccc; padding: 8px; font-weight: bold;">Phase 1: データ基盤整備</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">意思決定速度</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">平均3.5日</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">平均1.5日</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">機会損失の削減 (年間 約5,000万円)</td>
                                            </tr>
                                            <tr>
                                                <td style="border: 1px solid #ccc; padding: 8px; font-weight: bold;">Phase 1: データ基盤整備</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">データアクセス時間</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">平均45分</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">平均5分</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">分析業務の効率化 (年間 約3,000万円)</td>
                                            </tr>
                                            <tr>
                                                <td style="border: 1px solid #ccc; padding: 8px; font-weight: bold;">Phase 2: AI予測活用</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">需要予測精度</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">60%</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">85%</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">在庫最適化によるコスト削減 (年間 約1.2億円)</td>
                                            </tr>
                                            <tr>
                                                <td style="border: 1px solid #ccc; padding: 8px; font-weight: bold;">Phase 2: AI予測活用</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">投資回収率 (ROI)</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">—</td>
                                                <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">350% (3年)</td>
                                                <td style="border: 1px solid #ccc; padding: 8px;">高収益事業への戦略的再投資</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        `
                    });
                    break;
            }
            
            currentSlideIndex = 0;
            updateSlide();
            showPreviewModal(`AIプレゼンテーション - ${type}`);
        }
        
        // スライドの更新
        function updateSlide() {
            if (currentSlides.length === 0) return;
            
            const slide = currentSlides[currentSlideIndex];
            document.getElementById('slideContent').innerHTML = slide.content;
            document.getElementById('slideIndicator').textContent = `${currentSlideIndex + 1} / ${currentSlides.length}`;
            
            // 前後ボタンの有効/無効化
            document.getElementById('prevBtn').disabled = currentSlideIndex === 0;
            document.getElementById('nextBtn').disabled = currentSlideIndex === currentSlides.length - 1;
            
            // スライド固有の初期化処理があれば実行
            if (slide.init) {
                setTimeout(slide.init, 100);
            }
        }
        
        // 前のスライド
        function previousSlide() {
            if (currentSlideIndex > 0) {
                currentSlideIndex--;
                updateSlide();
            }
        }
        
        // 次のスライド
        function nextSlide() {
            if (currentSlideIndex < currentSlides.length - 1) {
                currentSlideIndex++;
                updateSlide();
            }
        }
        
        // ダウンロードボタンのイベントハンドラ
        document.getElementById('downloadBtn').addEventListener('click', function() {
            switch(currentType) {
                case 'chart':
                    generateChart(currentSubType);
                    break;
                case 'table':
                    generateTable(currentSubType);
                    break;
                case 'shape':
                    generateShape(currentSubType);
                    break;
                case 'text':
                    generateText(currentSubType);
                    break;
                case 'ai':
                    generateAI(currentSubType);
                    break;
            }
            bootstrap.Modal.getInstance(document.getElementById('previewModal')).hide();
        });

        // =========================
        // JSONベースPPTX生成機能
        // =========================
        
        // JSON検証機能
        function validateJSON() {
            const jsonText = document.getElementById('jsonInput').value;
            const resultDiv = document.getElementById('jsonValidationResult');
            
            try {
                const data = JSON.parse(jsonText);
                
                // 基本構造の検証
                const requiredFields = ['title', 'slides'];
                const missingFields = requiredFields.filter(field => !data[field]);
                
                if (missingFields.length > 0) {
                    showValidationResult('danger', `必須フィールドが不足しています: ${missingFields.join(', ')}`);
                    return false;
                }
                
                // スライド構造の検証
                if (!Array.isArray(data.slides) || data.slides.length === 0) {
                    showValidationResult('danger', 'slidesは空でない配列である必要があります');
                    return false;
                }
                
                // 各スライドの検証
                for (let i = 0; i < data.slides.length; i++) {
                    const slide = data.slides[i];
                    if (!slide.elements || !Array.isArray(slide.elements)) {
                        showValidationResult('warning', `スライド${i + 1}: elementsが配列ではありません`);
                    }
                }
                
                showValidationResult('success', `✅ JSON構造は有効です (${data.slides.length}スライド)`);
                return true;
                
            } catch (error) {
                showValidationResult('danger', `❌ JSON構文エラー: ${error.message}`);
                return false;
            }
        }
        
        // 検証結果の表示
        function showValidationResult(type, message) {
            const resultDiv = document.getElementById('jsonValidationResult');
            resultDiv.className = `alert alert-${type}`;
            resultDiv.textContent = message;
            resultDiv.style.display = 'block';
            
            // 5秒後に非表示
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }
        
        // サンプルJSON読み込み
        function loadSampleJSON() {
            const sampleJSON = {
                "title": "AI・機械学習の最新動向",
                "author": "Tech Innovation Team",
                "company": "Future Tech Solutions",
                "layout": "LAYOUT_16x9",
                "slides": [
                    {
                        "slideIndex": 0,
                        "topic": "AI革命の始まり",
                        "background": {
                            "type": "gradient",
                            "colors": ["667eea", "764ba2"],
                            "angle": 135
                        },
                        "elements": [
                            {
                                "type": "shape",
                                "shapeType": "rect",
                                "options": {"x": 0, "y": 0, "w": 100, "h": 100},
                                "style": {
                                    "fill": {"color": "000000", "transparency": 40}
                                }
                            },
                            {
                                "type": "text",
                                "textType": "title",
                                "content": "AI革命の始まり",
                                "options": {"x": 5, "y": 35, "w": 90, "h": 15},
                                "style": {
                                    "fontSize": 48,
                                    "bold": true,
                                    "color": "FFFFFF",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "text", 
                                "textType": "subtitle",
                                "content": "機械学習・深層学習の最新技術動向",
                                "options": {"x": 5, "y": 52, "w": 90, "h": 10},
                                "style": {
                                    "fontSize": 24,
                                    "color": "E0E0E0",
                                    "align": "center"
                                }
                            }
                        ]
                    },
                    {
                        "slideIndex": 1,
                        "topic": "AI技術の現状分析",
                        "background": "#F8F9FA",
                        "elements": [
                            {
                                "type": "text",
                                "textType": "title", 
                                "content": "AI技術の現状分析",
                                "options": {"x": 5, "y": 8, "w": 90, "h": 12},
                                "style": {
                                    "fontSize": 42,
                                    "bold": true,
                                    "color": "1F2937",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "chart",
                                "chartType": "bar",
                                "data": [
                                    {
                                        "name": "AI導入率",
                                        "labels": ["自然言語処理", "画像認識", "音声認識", "予測分析", "自動化"],
                                        "values": [92, 87, 78, 85, 74]
                                    }
                                ],
                                "options": {"x": 10, "y": 25, "w": 80, "h": 60},
                                "chartOptions": {
                                    "title": "AI技術領域別普及率（%）",
                                    "showValue": true,
                                    "showLegend": false,
                                    "chartColors": ["4285F4", "34A853", "FBBC04", "EA4335", "9C27B0"]
                                }
                            }
                        ]
                    },
                    {
                        "slideIndex": 2,
                        "topic": "産業別AI導入効果",
                        "background": "#FFFFFF",
                        "elements": [
                            {
                                "type": "text",
                                "textType": "title",
                                "content": "産業別AI導入効果の比較",
                                "options": {"x": 5, "y": 5, "w": 90, "h": 15},
                                "style": {
                                    "fontSize": 36,
                                    "bold": true,
                                    "color": "1F2937",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "table",
                                "data": [
                                    [
                                        {"text": "産業分野", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
                                        {"text": "導入率", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
                                        {"text": "効果実感", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
                                        {"text": "ROI", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}},
                                        {"text": "評価", "options": {"fill": "4285F4", "color": "FFFFFF", "bold": true}}
                                    ],
                                    ["金融・保険", "89%", "95%", "320%", "★★★★★"],
                                    ["製造業", "76%", "88%", "280%", "★★★★☆"], 
                                    ["ヘルスケア", "82%", "92%", "350%", "★★★★★"],
                                    ["小売・EC", "71%", "84%", "240%", "★★★☆☆"],
                                    ["物流・運輸", "68%", "81%", "220%", "★★★☆☆"],
                                    ["エネルギー", "74%", "87%", "300%", "★★★★☆"]
                                ],
                                "options": {"x": 5, "y": 25, "w": 90, "h": 65},
                                "tableOptions": {
                                    "border": {"type": "solid", "pt": 1, "color": "CCCCCC"},
                                    "fontSize": 14,
                                    "align": "center"
                                }
                            }
                        ]
                    },
                    {
                        "slideIndex": 3,
                        "topic": "高度な図形とビジュアル",
                        "background": "#F5F7FA",
                        "elements": [
                            {
                                "type": "text",
                                "textType": "title",
                                "content": "AI技術のアーキテクチャ",
                                "options": {"x": 5, "y": 5, "w": 90, "h": 12},
                                "style": {
                                    "fontSize": 36,
                                    "bold": true,
                                    "color": "1F2937",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "roundRect",
                                "options": {"x": 10, "y": 25, "w": 25, "h": 15},
                                "style": {
                                    "fill": {"color": "4285F4"},
                                    "line": {"color": "2563EB", "width": 2},
                                    "rectRadius": 0.3
                                }
                            },
                            {
                                "type": "text",
                                "content": "データ収集",
                                "options": {"x": 10, "y": 25, "w": 25, "h": 15},
                                "style": {
                                    "fontSize": 16,
                                    "bold": true,
                                    "color": "FFFFFF",
                                    "align": "center",
                                    "valign": "middle"
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "roundRect", 
                                "options": {"x": 40, "y": 25, "w": 25, "h": 15},
                                "style": {
                                    "fill": {"color": "34A853"},
                                    "line": {"color": "16A249", "width": 2},
                                    "rectRadius": 0.3
                                }
                            },
                            {
                                "type": "text",
                                "content": "機械学習",
                                "options": {"x": 40, "y": 25, "w": 25, "h": 15},
                                "style": {
                                    "fontSize": 16,
                                    "bold": true,
                                    "color": "FFFFFF",
                                    "align": "center",
                                    "valign": "middle"
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "roundRect",
                                "options": {"x": 70, "y": 25, "w": 25, "h": 15},
                                "style": {
                                    "fill": {"color": "EA4335"},
                                    "line": {"color": "DC2626", "width": 2},
                                    "rectRadius": 0.3
                                }
                            },
                            {
                                "type": "text",
                                "content": "予測・判断",
                                "options": {"x": 70, "y": 25, "w": 25, "h": 15},
                                "style": {
                                    "fontSize": 16,
                                    "bold": true,
                                    "color": "FFFFFF",
                                    "align": "center",
                                    "valign": "middle"
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "rightArrow",
                                "options": {"x": 36, "y": 31, "w": 3, "h": 3},
                                "style": {
                                    "fill": {"color": "6B7280"}
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "rightArrow",
                                "options": {"x": 66, "y": 31, "w": 3, "h": 3},
                                "style": {
                                    "fill": {"color": "6B7280"}
                                }
                            }
                        ]
                    },
                    {
                        "slideIndex": 4,
                        "topic": "今後の展望と課題",
                        "background": "#F8FAFC",
                        "elements": [
                            {
                                "type": "text",
                                "textType": "title",
                                "content": "AI技術の今後の展望と課題",
                                "options": {"x": 5, "y": 8, "w": 90, "h": 12},
                                "style": {
                                    "fontSize": 36,
                                    "bold": true,
                                    "color": "0F172A",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "rect",
                                "options": {"x": 8, "y": 25, "w": 40, "h": 65},
                                "style": {
                                    "fill": {"color": "E0F2FE"},
                                    "line": {"color": "0EA5E9", "width": 2}
                                }
                            },
                            {
                                "type": "text",
                                "textType": "subtitle",
                                "content": "機会・展望",
                                "options": {"x": 10, "y": 28, "w": 36, "h": 8},
                                "style": {
                                    "fontSize": 20,
                                    "bold": true,
                                    "color": "0C4A6E",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "text",
                                "content": "• AGI（汎用人工知能）の実現\n• 量子コンピューティング連携\n• 自律システムの高度化\n• 創薬・材料科学での革新\n• カーボンニュートラル支援",
                                "options": {"x": 10, "y": 38, "w": 36, "h": 45},
                                "style": {
                                    "fontSize": 14,
                                    "color": "1F2937",
                                    "lineSpacing": 24
                                }
                            },
                            {
                                "type": "shape",
                                "shapeType": "rect",
                                "options": {"x": 52, "y": 25, "w": 40, "h": 65},
                                "style": {
                                    "fill": {"color": "FEF3C7"},
                                    "line": {"color": "F59E0B", "width": 2}
                                }
                            },
                            {
                                "type": "text",
                                "textType": "subtitle",
                                "content": "課題・リスク",
                                "options": {"x": 54, "y": 28, "w": 36, "h": 8},
                                "style": {
                                    "fontSize": 20,
                                    "bold": true,
                                    "color": "92400E",
                                    "align": "center"
                                }
                            },
                            {
                                "type": "text",
                                "content": "• プライバシー・セキュリティ\n• アルゴリズムバイアス\n• 雇用への影響\n• エネルギー消費問題\n• 規制・ガバナンス整備",
                                "options": {"x": 54, "y": 38, "w": 36, "h": 45},
                                "style": {
                                    "fontSize": 14,
                                    "color": "1F2937",
                                    "lineSpacing": 24
                                }
                            }
                        ]
                    }
                ]
            };
            
            document.getElementById('jsonInput').value = JSON.stringify(sampleJSON, null, 2);
            showValidationResult('info', '📄 サンプルJSONを読み込みました');
        }
        
        // JSONからプレビュー生成
        function previewFromJSON() {
            if (!validateJSON()) return;
            
            try {
                const jsonData = JSON.parse(document.getElementById('jsonInput').value);
                currentType = 'json';
                currentSubType = 'custom';
                currentSlides = [];
                
                // 各スライドをプレビュー用に変換
                jsonData.slides.forEach((slideData, index) => {
                    let slideHTML = '';
                    
                    // 背景の適用
                    let backgroundStyle = '';
                    if (slideData.background) {
                        if (typeof slideData.background === 'string') {
                            backgroundStyle = `background-color: ${slideData.background};`;
                        } else if (slideData.background.type === 'gradient') {
                            const colors = slideData.background.colors.map(c => `#${c}`).join(', ');
                            backgroundStyle = `background: linear-gradient(${slideData.background.angle || 135}deg, ${colors});`;
                        }
                    }
                    
                    slideHTML = `<div style="${backgroundStyle} width: 100%; height: 100%; position: relative; padding: 20px;">`;
                    
                    // 各要素を処理
                    slideData.elements.forEach(element => {
                        const opts = element.options || {};
                        const style = element.style || {};
                        
                        switch (element.type) {
                            case 'text':
                                const fontSize = style.fontSize || 16;
                                const color = style.color ? `#${style.color}` : '#000000';
                                const fontWeight = style.bold ? 'bold' : 'normal';
                                const textAlign = style.align || 'left';
                                
                                slideHTML += `
                                    <div style="
                                        position: absolute;
                                        left: ${opts.x || 0}%;
                                        top: ${opts.y || 0}%;
                                        width: ${opts.w || 50}%;
                                        height: ${opts.h || 10}%;
                                        font-size: ${fontSize}px;
                                        color: ${color};
                                        font-weight: ${fontWeight};
                                        text-align: ${textAlign};
                                        display: flex;
                                        align-items: center;
                                        ${textAlign === 'center' ? 'justify-content: center;' : ''}
                                    ">
                                        ${element.content}
                                    </div>
                                `;
                                break;
                                
                            case 'chart':
                                slideHTML += `
                                    <div style="
                                        position: absolute;
                                        left: ${opts.x || 10}%;
                                        top: ${opts.y || 20}%;
                                        width: ${opts.w || 80}%;
                                        height: ${opts.h || 60}%;
                                        background: white;
                                        border: 1px solid #ddd;
                                        border-radius: 5px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        flex-direction: column;
                                    ">
                                        <canvas id="chart_${index}_${Math.random().toString(36).substr(2, 9)}" width="400" height="300"></canvas>
                                        <p style="margin-top: 10px; color: #666; font-size: 14px;">${element.chartOptions?.title || 'チャート'}</p>
                                    </div>
                                `;
                                break;
                                
                            case 'table':
                                let tableHTML = '<table style="width: 100%; border-collapse: collapse;">';
                                element.data.forEach((row, rowIndex) => {
                                    tableHTML += '<tr>';
                                    row.forEach(cell => {
                                        const cellData = typeof cell === 'string' ? { text: cell, options: {} } : cell;
                                        const cellStyle = cellData.options || {};
                                        const bgColor = cellStyle.fill ? `#${cellStyle.fill}` : '';
                                        const textColor = cellStyle.color ? `#${cellStyle.color}` : '';
                                        const isHeader = rowIndex === 0;
                                        
                                        tableHTML += `
                                            <${isHeader ? 'th' : 'td'} style="
                                                border: 1px solid #ccc;
                                                padding: 8px;
                                                background-color: ${bgColor};
                                                color: ${textColor};
                                                font-weight: ${cellStyle.bold ? 'bold' : 'normal'};
                                                text-align: center;
                                            ">
                                                ${cellData.text}
                                            </${isHeader ? 'th' : 'td'}>
                                        `;
                                    });
                                    tableHTML += '</tr>';
                                });
                                tableHTML += '</table>';
                                
                                slideHTML += `
                                    <div style="
                                        position: absolute;
                                        left: ${opts.x || 10}%;
                                        top: ${opts.y || 20}%;
                                        width: ${opts.w || 80}%;
                                        height: ${opts.h || 60}%;
                                        overflow: auto;
                                    ">
                                        ${tableHTML}
                                    </div>
                                `;
                                break;
                                
                            case 'shape':
                                const shapeStyle = element.style || {};
                                const fillColor = shapeStyle.fill?.color ? `#${shapeStyle.fill.color}` : '#cccccc';
                                const borderColor = shapeStyle.line?.color ? `#${shapeStyle.line.color}` : '#000000';
                                const borderWidth = shapeStyle.line?.width || 1;
                                const borderRadius = element.shapeType === 'roundRect' ? '10px' : '0';
                                
                                slideHTML += `
                                    <div style="
                                        position: absolute;
                                        left: ${opts.x || 10}%;
                                        top: ${opts.y || 20}%;
                                        width: ${opts.w || 20}%;
                                        height: ${opts.h || 15}%;
                                        background-color: ${fillColor};
                                        border: ${borderWidth}px solid ${borderColor};
                                        border-radius: ${borderRadius};
                                    ">
                                    </div>
                                `;
                                break;
                        }
                    });
                    
                    slideHTML += '</div>';
                    
                    currentSlides.push({
                        title: slideData.topic || `スライド ${index + 1}`,
                        content: slideHTML
                    });
                });
                
                currentSlideIndex = 0;
                updateSlide();
                showPreviewModal(`JSONプレビュー - ${jsonData.title}`);
                
            } catch (error) {
                showValidationResult('danger', `プレビュー生成エラー: ${error.message}`);
            }
        }
        
        // JSONからPPTX生成
        function generateFromJSON() {
            if (!validateJSON()) return;
            
            try {
                const jsonData = JSON.parse(document.getElementById('jsonInput').value);
                let pptx = new PptxGenJS();
                
                // プレゼンテーション設定
                if (jsonData.layout) pptx.layout = jsonData.layout;
                if (jsonData.title) pptx.title = jsonData.title;
                if (jsonData.author) pptx.author = jsonData.author;
                if (jsonData.company) pptx.company = jsonData.company;
                
                // 各スライドを生成
                jsonData.slides.forEach(slideData => {
                    let slide = pptx.addSlide();
                    
                    // 背景設定
                    if (slideData.background) {
                        if (typeof slideData.background === 'string') {
                            slide.background = { color: slideData.background.replace('#', '') };
                        } else if (slideData.background.type === 'gradient') {
                            // グラデーション背景（図形で代替）
                            slide.addShape(pptx.ShapeType.rect, {
                                x: 0, y: 0, w: '100%', h: '100%',
                                fill: { color: slideData.background.colors[0] }
                            });
                        }
                    }
                    
                    // 各要素を追加
                    slideData.elements.forEach(element => {
                        const opts = element.options || {};
                        const style = element.style || {};
                        
                        // 座標の正規化（%を0-100のスケールで処理）
                        const normalizeCoord = (value, isPercentage = false) => {
                            if (typeof value === 'string' && value.includes('%')) {
                                return parseFloat(value) / 100 * (isPercentage ? 100 : 10);
                            }
                            return typeof value === 'number' ? value / 10 : value;
                        };
                        
                        const position = {
                            x: normalizeCoord(opts.x),
                            y: normalizeCoord(opts.y),
                            w: normalizeCoord(opts.w),
                            h: normalizeCoord(opts.h)
                        };
                        
                        switch (element.type) {
                            case 'text':
                                const textOptions = {
                                    ...position,
                                    fontSize: style.fontSize || 16,
                                    color: style.color || '000000',
                                    bold: style.bold || false,
                                    align: style.align || 'left',
                                    valign: style.valign || 'top'
                                };
                                
                                slide.addText(element.content, textOptions);
                                break;
                                
                            case 'chart':
                                const chartData = element.data || [];
                                const chartOptions = {
                                    ...position,
                                    title: element.chartOptions?.title || '',
                                    showValue: element.chartOptions?.showValue || false,
                                    showLegend: element.chartOptions?.showLegend !== false,
                                    chartColors: element.chartOptions?.chartColors || ['4285F4', '34A853', 'FBBC04', 'EA4335']
                                };
                                
                                if (chartData.length > 0) {
                                    slide.addChart(element.chartType || 'bar', chartData, chartOptions);
                                }
                                break;
                                
                            case 'table':
                                const tableOptions = {
                                    ...position,
                                    border: element.tableOptions?.border || { type: 'solid', pt: 1, color: 'CCCCCC' },
                                    fontSize: element.tableOptions?.fontSize || 12,
                                    align: element.tableOptions?.align || 'center'
                                };
                                
                                slide.addTable(element.data || [], tableOptions);
                                break;
                                
                            case 'shape':
                                const shapeType = element.shapeType || 'rect';
                                const shapeOptions = {
                                    ...position,
                                    fill: element.style?.fill || { color: 'CCCCCC' },
                                    line: element.style?.line || { color: '000000', width: 1 }
                                };
                                
                                if (element.style?.rectRadius) {
                                    shapeOptions.rectRadius = element.style.rectRadius;
                                }
                                
                                slide.addShape(pptx.ShapeType[shapeType] || pptx.ShapeType.rect, shapeOptions);
                                break;
                                
                            case 'image':
                                const imageOptions = {
                                    ...position,
                                    path: element.path,
                                    data: element.data,
                                    sizing: element.sizing,
                                    transparency: element.transparency || 0,
                                    rotate: element.rotate || 0,
                                    flipH: element.flipH || false,
                                    flipV: element.flipV || false
                                };
                                
                                if (element.path || element.data) {
                                    slide.addImage(imageOptions);
                                }
                                break;
                        }
                    });
                });
                
                const fileName = `${jsonData.title || 'JSON-Generated-Presentation'}.pptx`;
                pptx.writeFile({ fileName: fileName });
                
                showValidationResult('success', `✅ PPTX生成完了: ${fileName}`);
                
            } catch (error) {
                showValidationResult('danger', `PPTX生成エラー: ${error.message}`);
            }
        }
        
        // 高度な機能のプレビュー・生成
        function previewAdvanced(type) {
            currentType = 'advanced';
            currentSubType = type;
            currentSlides = [];
            
            switch(type) {
                case 'shapes':
                    currentSlides.push({
                        title: '高度な図形機能',
                        content: `
                            <div style="padding: 20px;">
                                <h2 class="mb-4">高度な図形機能</h2>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 300px;">
                                    <div style="text-align: center;">
                                        <h4>カスタムジオメトリ</h4>
                                        <svg width="200" height="150" style="border: 1px solid #ddd;">
                                            <path d="M 50 50 L 150 50 Q 180 50 180 80 L 180 120 Q 180 150 150 150 L 50 150 Q 20 150 20 120 L 20 80 Q 20 50 50 50 Z" 
                                                  fill="#4285F4" stroke="#1565C0" stroke-width="2"/>
                                            <circle cx="100" cy="100" r="20" fill="#34A853" opacity="0.8"/>
                                        </svg>
                                    </div>
                                    <div style="text-align: center;">
                                        <h4>影効果・グラデーション</h4>
                                        <div style="
                                            width: 120px; height: 80px; margin: 20px auto;
                                            background: linear-gradient(45deg, #667eea, #764ba2);
                                            border-radius: 10px;
                                            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
                                            display: flex; align-items: center; justify-content: center;
                                            color: white; font-weight: bold;
                                        ">
                                            グラデーション
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                    break;
                    
                case 'images':
                    currentSlides.push({
                        title: '画像処理機能',
                        content: `
                            <div style="padding: 20px;">
                                <h2 class="mb-4">画像処理機能</h2>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                                    <div style="text-align: center;">
                                        <h5>リサイズ・クロッピング</h5>
                                        <div style="width: 100px; height: 60px; margin: 10px auto; background: #f0f0f0; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; font-size: 12px;">
                                            CROP
                                        </div>
                                    </div>
                                    <div style="text-align: center;">
                                        <h5>透明度・回転</h5>
                                        <div style="width: 80px; height: 80px; margin: 10px auto; background: #4285F4; opacity: 0.5; transform: rotate(25deg); border-radius: 50%;"></div>
                                    </div>
                                    <div style="text-align: center;">
                                        <h5>SVGサポート</h5>
                                        <svg width="80" height="80" style="margin: 10px auto;">
                                            <polygon points="40,5 75,35 60,70 20,70 5,35" fill="#34A853"/>
                                            <text x="40" y="45" text-anchor="middle" fill="white" font-size="12">SVG</text>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                    break;
                    
                case 'charts':
                    currentSlides.push({
                        title: '高度なチャート機能',
                        content: `
                            <div style="padding: 20px;">
                                <h2 class="mb-4">高度なチャート機能</h2>
                                <div style="display: flex; justify-content: space-around; height: 250px; align-items: center;">
                                    <div style="text-align: center;">
                                        <h5>3Dチャート</h5>
                                        <canvas id="advanced3DChart" width="150" height="150"></canvas>
                                    </div>
                                    <div style="text-align: center;">
                                        <h5>マルチシリーズ</h5>
                                        <canvas id="advancedMultiChart" width="150" height="150"></canvas>
                                    </div>
                                </div>
                            </div>
                        `,
                        init: () => {
                            // 3Dチャートのサンプル
                            const ctx3D = document.getElementById('advanced3DChart')?.getContext('2d');
                            if (ctx3D) {
                                new Chart(ctx3D, {
                                    type: 'bar',
                                    data: {
                                        labels: ['A', 'B', 'C'],
                                        datasets: [{
                                            data: [10, 20, 15],
                                            backgroundColor: ['#4285F4', '#34A853', '#FBBC04']
                                        }]
                                    },
                                    options: { responsive: false, plugins: { legend: { display: false } } }
                                });
                            }
                            
                            // マルチシリーズチャート
                            const ctxMulti = document.getElementById('advancedMultiChart')?.getContext('2d');
                            if (ctxMulti) {
                                new Chart(ctxMulti, {
                                    type: 'line',
                                    data: {
                                        labels: ['Jan', 'Feb', 'Mar'],
                                        datasets: [
                                            { label: 'Series 1', data: [10, 15, 12], borderColor: '#4285F4', fill: false },
                                            { label: 'Series 2', data: [8, 12, 18], borderColor: '#34A853', fill: false }
                                        ]
                                    },
                                    options: { responsive: false }
                                });
                            }
                        }
                    });
                    break;
            }
            
            currentSlideIndex = 0;
            updateSlide();
            showPreviewModal(`高度な機能 - ${type}`);
        }
        
        function generateAdvanced(type) {
            let pptx = new PptxGenJS();
            let slide = pptx.addSlide();
            
            switch(type) {
                case 'shapes':
                    // タイトル
                    slide.addText('高度な図形機能デモ', { x: 1, y: 0.5, w: 8, h: 1, fontSize: 24, bold: true });
                    
                    // カスタムジオメトリ
                    slide.addShape(pptx.ShapeType.custGeom, {
                        x: 1, y: 2, w: 3, h: 2,
                        points: [
                            { x: 0, y: 0.5 },
                            { x: 0.5, y: 0, curve: { type: 'quadratic', x1: 0.3, y1: 0.2 } },
                            { x: 1, y: 0.5 },
                            { x: 0.5, y: 1, curve: { type: 'quadratic', x1: 0.7, y1: 0.8 } },
                            { close: true }
                        ],
                        fill: { color: '4285F4' },
                        shadow: { type: 'outer', blur: 10, offset: 5, angle: 45, color: '000000', opacity: 0.3 }
                    });
                    
                    // グラデーション図形
                    slide.addShape(pptx.ShapeType.roundRect, {
                        x: 5, y: 2, w: 3, h: 2,
                        fill: { color: '667eea' },
                        rectRadius: 0.3,
                        shadow: { type: 'outer', blur: 15, offset: 8, angle: 135, color: '667eea', opacity: 0.5 }
                    });
                    
                    break;
                    
                case 'images':
                    slide.addText('画像処理機能デモ', { x: 1, y: 0.5, w: 8, h: 1, fontSize: 24, bold: true });
                    
                    // Base64サンプル画像（小さな青い正方形）
                    const sampleImageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
                    
                    // 通常の画像
                    slide.addImage({
                        data: sampleImageData,
                        x: 1, y: 2, w: 2, h: 1.5
                    });
                    
                    // 透明度付き画像
                    slide.addImage({
                        data: sampleImageData,
                        x: 4, y: 2, w: 2, h: 1.5,
                        transparency: 50
                    });
                    
                    // 回転画像
                    slide.addImage({
                        data: sampleImageData,
                        x: 7, y: 2, w: 2, h: 1.5,
                        rotate: 45
                    });
                    
                    break;
                    
                case 'charts':
                    slide.addText('高度なチャート機能デモ', { x: 1, y: 0.5, w: 8, h: 1, fontSize: 24, bold: true });
                    
                    // 3Dバーチャート
                    slide.addChart(pptx.ChartType.bar3D, [
                        {
                            name: '3Dデータ',
                            labels: ['カテゴリA', 'カテゴリB', 'カテゴリC'],
                            values: [30, 45, 25]
                        }
                    ], {
                        x: 1, y: 2, w: 4, h: 3,
                        title: '3Dバーチャート',
                        chartColors: ['4285F4', '34A853', 'FBBC04'],
                        showValue: true
                    });
                    
                    // マルチシリーズラインチャート
                    slide.addChart(pptx.ChartType.line, [
                        {
                            name: 'シリーズ1',
                            labels: ['1月', '2月', '3月', '4月'],
                            values: [10, 15, 12, 18]
                        },
                        {
                            name: 'シリーズ2',
                            labels: ['1月', '2月', '3月', '4月'],
                            values: [8, 12, 16, 14]
                        }
                    ], {
                        x: 5.5, y: 2, w: 4, h: 3,
                        title: 'マルチシリーズチャート',
                        showLegend: true,
                        chartColors: ['EA4335', '34A853']
                    });
                    
                    break;
            }
            
            pptx.writeFile({ fileName: `advanced-${type}-demo.pptx` });
        }

        // コンサルティング評価レポートのJSONからPPTX生成機能
        function generateConsultingReport() {
            const consultingJson = {
                "title": "コンサルティング評価レポート：現状分析と戦略的提言",
                "author": "AI Slide Generator",
                "company": "AI-Powered Presentation System",
                "slides": [
                    {
                        "slideIndex": 0,
                        "topic": "評価の背景とアプローチ",
                        "elements": [
                            {
                                "content": "事業価値を倍増させるDX評価：背景と戦略的アプローチ",
                                "options": {
                                    "h": 12,
                                    "w": 90,
                                    "x": 5,
                                    "y": 5
                                },
                                "type": "text",
                                "style": {
                                    "align": "center",
                                    "bold": true,
                                    "color": "#1A365D",
                                    "fontSize": 32
                                },
                                "textType": "title"
                            },
                            {
                                "options": {
                                    "h": 0.5,
                                    "w": 60,
                                    "x": 20,
                                    "y": 18
                                },
                                "shapeType": "line",
                                "type": "shape",
                                "purpose": "divider",
                                "style": {
                                    "line": {
                                        "color": "#4A90E2",
                                        "width": 2
                                    }
                                }
                            },
                            {
                                "data": [
                                    [
                                        {
                                            "text": "評価項目",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#FFFFFF",
                                                "fill": "#4A90E2"
                                            }
                                        },
                                        {
                                            "text": "測定指標 (KPI)",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#FFFFFF",
                                                "fill": "#4A90E2"
                                            }
                                        },
                                        {
                                            "text": "従来型アプローチ",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#FFFFFF",
                                                "fill": "#4A90E2"
                                            }
                                        },
                                        {
                                            "text": "提案データ駆動型アプローチ",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#FFFFFF",
                                                "fill": "#4A90E2"
                                            }
                                        },
                                        {
                                            "text": "期待効果 (差分)",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#FFFFFF",
                                                "fill": "#4A90E2"
                                            }
                                        }
                                    ],
                                    [
                                        {
                                            "text": "効率性",
                                            "options": {
                                                "align": "left",
                                                "bold": true
                                            }
                                        },
                                        {
                                            "text": "業務処理時間",
                                            "options": {
                                                "align": "left"
                                            }
                                        },
                                        {
                                            "text": "40時間/週",
                                            "options": {
                                                "align": "center"
                                            }
                                        },
                                        {
                                            "text": "26時間/週",
                                            "options": {
                                                "align": "center"
                                            }
                                        },
                                        {
                                            "text": "-35%",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#155724",
                                                "fill": "#D4EDDA"
                                            }
                                        }
                                    ],
                                    [
                                        {
                                            "text": "コスト",
                                            "options": {
                                                "align": "left",
                                                "bold": true
                                            }
                                        },
                                        {
                                            "text": "導入・運用コスト",
                                            "options": {
                                                "align": "left"
                                            }
                                        },
                                        {
                                            "text": "500百万円/年",
                                            "options": {
                                                "align": "center"
                                            }
                                        },
                                        {
                                            "text": "400百万円/年",
                                            "options": {
                                                "align": "center",
                                                "fill": "#D1ECF1"
                                            }
                                        },
                                        {
                                            "text": "-20%",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#155724",
                                                "fill": "#D4EDDA"
                                            }
                                        }
                                    ],
                                    [
                                        {
                                            "text": "リスク",
                                            "options": {
                                                "align": "left",
                                                "bold": true
                                            }
                                        },
                                        {
                                            "text": "プロジェクト成功率*",
                                            "options": {
                                                "align": "left"
                                            }
                                        },
                                        {
                                            "text": "75%",
                                            "options": {
                                                "align": "center"
                                            }
                                        },
                                        {
                                            "text": "95%",
                                            "options": {
                                                "align": "center",
                                                "fill": "#D1ECF1"
                                            }
                                        },
                                        {
                                            "text": "+20pt",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#155724",
                                                "fill": "#D4EDDA"
                                            }
                                        }
                                    ],
                                    [
                                        {
                                            "text": "ROI",
                                            "options": {
                                                "align": "left",
                                                "bold": true
                                            }
                                        },
                                        {
                                            "text": "投資回収期間",
                                            "options": {
                                                "align": "left"
                                            }
                                        },
                                        {
                                            "text": "36ヶ月",
                                            "options": {
                                                "align": "center"
                                            }
                                        },
                                        {
                                            "text": "18ヶ月",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "fill": "#D1ECF1"
                                            }
                                        },
                                        {
                                            "text": "期間半減",
                                            "options": {
                                                "align": "center",
                                                "bold": true,
                                                "color": "#155724",
                                                "fill": "#D4EDDA"
                                            }
                                        }
                                    ]
                                ],
                                "options": {
                                    "h": 50,
                                    "w": 90,
                                    "x": 5,
                                    "y": 32
                                },
                                "type": "table",
                                "colW": [15, 25, 20, 20, 20],
                                "keyMessage": "データ駆動型アプローチにより、効率性、コスト、リスク、ROIの全指標で大幅な改善が見込まれます。",
                                "notes": "* 出典: 業界ベンチマークレポート (Gartner)",
                                "title": "アプローチ別 評価指標比較"
                            }
                        ],
                        "background": "#F5F8FA"
                    },
                    {
                        "slideIndex": 1,
                        "topic": "評価フレームワークと評価軸",
                        "elements": [
                            {
                                "content": "新評価フレームワークによる成果",
                                "options": {
                                    "h": 8,
                                    "w": 90,
                                    "x": 5,
                                    "y": 4
                                },
                                "type": "text",
                                "style": {
                                    "align": "center",
                                    "bold": true,
                                    "color": "#1A365D",
                                    "fontSize": 32
                                },
                                "textType": "title"
                            },
                            {
                                "content": "Dynamic DXフレームワーク導入で主要KPIが大幅改善",
                                "options": {
                                    "h": 5,
                                    "w": 90,
                                    "x": 5,
                                    "y": 12
                                },
                                "type": "text",
                                "style": {
                                    "align": "center",
                                    "color": "#334E68",
                                    "fontSize": 16
                                },
                                "textType": "subtitle"
                            },
                            {
                                "options": {
                                    "h": 50,
                                    "w": 29,
                                    "x": 4,
                                    "y": 22
                                },
                                "shapeType": "roundedRectangle",
                                "type": "shape",
                                "purpose": "container",
                                "style": {
                                    "fill": {
                                        "color": "#FFFFFF",
                                        "type": "solid"
                                    },
                                    "shadow": {
                                        "blur": 8,
                                        "color": "#000000",
                                        "opacity": 0.1,
                                        "type": "outer"
                                    }
                                }
                            }
                        ],
                        "background": "#F0F4F8"
                    }
                ]
            };

            generatePptxFromJson(consultingJson);
        }

        // JSON構造からPPTX生成するメイン関数
        function generatePptxFromJson(jsonData) {
            console.log('🚀 PPTX生成開始:', jsonData.title);
            
            const pptx = new PptxGenJS();
            
            // プレゼンテーション設定
            if (jsonData.title) pptx.title = jsonData.title;
            if (jsonData.author) pptx.author = jsonData.author;
            if (jsonData.company) pptx.company = jsonData.company;
            if (jsonData.layout) pptx.layout = jsonData.layout;
            
            // スライド生成
            jsonData.slides.forEach((slideData, slideIndex) => {
                console.log(`📄 スライド ${slideIndex + 1} 生成中...`);
                
                const slide = pptx.addSlide();
                
                // 背景設定
                if (slideData.background) {
                    const bgColor = slideData.background.startsWith('#') ? 
                        slideData.background.substring(1) : slideData.background;
                    slide.background = { color: bgColor };
                }
                
                // 要素追加
                if (slideData.elements && Array.isArray(slideData.elements)) {
                    slideData.elements.forEach((element, elementIndex) => {
                        try {
                            addElementToSlide(slide, element, elementIndex);
                        } catch (error) {
                            console.error(`❌ 要素 ${elementIndex} 処理エラー:`, error);
                        }
                    });
                }
            });
            
            // PPTX生成・ダウンロード
            const fileName = `${jsonData.title || 'generated-presentation'}.pptx`;
            pptx.writeFile({ fileName: fileName });
            console.log(`✅ PPTX生成完了: ${fileName}`);
        }

        // 個別要素をスライドに追加する関数
        function addElementToSlide(slide, element, elementIndex) {
            console.log(`🔧 要素 ${elementIndex} 処理中: ${element.type}`);
            
            // 座標変換（パーセンテージからインチへ）
            const convertCoords = (options) => {
                if (!options) return {};
                
                const converted = { ...options };
                
                // パーセンテージをインチに変換（スライド幅10インチ、高さ5.625インチ）
                if (typeof options.x === 'number') converted.x = (options.x / 100) * 10;
                if (typeof options.y === 'number') converted.y = (options.y / 100) * 5.625;
                if (typeof options.w === 'number') converted.w = (options.w / 100) * 10;
                if (typeof options.h === 'number') converted.h = (options.h / 100) * 5.625;
                
                return converted;
            };
            
            // スタイル統合（styleとoptionsをマージ）
            const mergeStyle = (options, style) => {
                if (!style) return options;
                
                const merged = { ...options };
                
                // カラー処理（#を除去）
                if (style.color) {
                    merged.color = style.color.startsWith('#') ? style.color.substring(1) : style.color;
                }
                if (style.fill && typeof style.fill === 'string') {
                    merged.fill = { color: style.fill.startsWith('#') ? style.fill.substring(1) : style.fill };
                } else if (style.fill && style.fill.color) {
                    merged.fill = { color: style.fill.color.startsWith('#') ? style.fill.color.substring(1) : style.fill.color };
                }
                
                // その他のスタイル
                if (style.fontSize) merged.fontSize = style.fontSize;
                if (style.bold) merged.bold = style.bold;
                if (style.italic) merged.italic = style.italic;
                if (style.align) merged.align = style.align;
                if (style.valign) merged.valign = style.valign;
                
                // ライン処理
                if (style.line) {
                    merged.line = { ...style.line };
                    if (merged.line.color) {
                        merged.line.color = merged.line.color.startsWith('#') ? 
                            merged.line.color.substring(1) : merged.line.color;
                    }
                }
                
                return merged;
            };
            
            const coords = convertCoords(element.options);
            const finalOptions = mergeStyle(coords, element.style);
            
            switch (element.type) {
                case 'text':
                    slide.addText(element.content || '', finalOptions);
                    break;
                    
                case 'shape':
                    const shapeMap = {
                        'line': 'line',
                        'rect': 'rect',
                        'oval': 'oval',
                        'roundedRectangle': 'roundRect',
                        'triangle': 'triangle',
                        'rightTriangle': 'triangle',
                        'arc': 'arc',
                        'chevron': 'chevron',
                        'pentagon': 'pentagon',
                        'hexagon': 'hexagon',
                        'octagon': 'octagon',
                        'cloud': 'cloud',
                        'heart': 'heart',
                        'pie': 'pie'
                    };
                    
                    const shapeType = shapeMap[element.shapeType] || element.shapeType;
                    slide.addShape(shapeType, finalOptions);
                    break;
                    
                case 'table':
                    // テーブルデータ処理の改善
                    const tableData = element.data || element.tableRows || [];
                    
                    if (!tableData || tableData.length === 0) {
                        console.warn(`⚠️ テーブルデータが空です (要素 ${elementIndex})`);
                        break;
                    }
                    
                    // テーブルオプション設定
                    const tableOptions = { ...finalOptions };
                    
                    // 列幅設定
                    if (element.colW && Array.isArray(element.colW)) {
                        tableOptions.colW = element.colW.map(w => (w / 100) * 10);
                    }
                    
                    // テーブルデータの正規化
                    const processedTableData = tableData.map((row, rowIndex) => {
                        if (!Array.isArray(row)) {
                            console.warn(`⚠️ 行 ${rowIndex} が配列ではありません:`, row);
                            return [];
                        }
                        
                        return row.map((cell, cellIndex) => {
                            if (typeof cell === 'string') {
                                return { text: cell, options: {} };
                            }
                            
                            if (cell && typeof cell === 'object') {
                                const cellOptions = { ...(cell.options || {}) };
                                
                                // セルの色処理
                                if (cellOptions.color) {
                                    cellOptions.color = cellOptions.color.startsWith('#') ? 
                                        cellOptions.color.substring(1) : cellOptions.color;
                                }
                                if (cellOptions.fill) {
                                    if (typeof cellOptions.fill === 'string') {
                                        cellOptions.fill = { 
                                            color: cellOptions.fill.startsWith('#') ? 
                                                cellOptions.fill.substring(1) : cellOptions.fill 
                                        };
                                    } else if (cellOptions.fill.color) {
                                        cellOptions.fill.color = cellOptions.fill.color.startsWith('#') ? 
                                            cellOptions.fill.color.substring(1) : cellOptions.fill.color;
                                    }
                                }
                                
                                return {
                                    text: cell.text || '',
                                    options: cellOptions
                                };
                            }
                            
                            return { text: String(cell || ''), options: {} };
                        });
                    });
                    
                    console.log(`📊 テーブル処理完了 (${processedTableData.length}行)`);
                    slide.addTable(processedTableData, tableOptions);
                    break;
                    
                case 'image':
                    slide.addImage({
                        path: element.path || element.src || '',
                        ...finalOptions
                    });
                    break;
                    
                case 'chart':
                    slide.addChart(
                        element.chartType,
                        element.chartSeries || element.data || [],
                        finalOptions
                    );
                    break;
                    
                default:
                    console.warn(`⚠️ 未対応の要素タイプ: ${element.type}`);
            }
        }
    </script>
</body>
</html>